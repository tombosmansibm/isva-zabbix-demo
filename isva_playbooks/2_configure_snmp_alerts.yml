---
#
# Set snmp alerts.
#
- hosts: "all"
  collections:
    - ibm.isam
  gather_facts: no
  vars:
    ansible_connection: ibm.isam.isam
  tasks:
    - name: debug the zabbix hostname (autogenerated from ip inventory hostname)
      debug:
        var: snmp_zabbixproxy

    - block:
       - name: "Set snmp alerts to {{ snmp_zabbixproxy }}"
         import_role:
            name: ske/set_system_alerts_snmp

      rescue:
        - name: error
          debug:
            msg: 'Error occurred during enabling of snmp. Rolling back.'

        - name: rollback changes for appliance
          ibm.isam.isam:
            log: "{{ log_level | default(omit) }}"
            force: "{{ force | default(omit) }}"
            action: ibmsecurity.isam.appliance.rollback